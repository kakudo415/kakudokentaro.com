<!doctype html><html lang=ja prefix="og: https://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://kakudokentaro.com/assets/fonts/Inter-SemiBold.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://kakudokentaro.com/assets/fonts/Inter-Regular.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://kakudokentaro.com/assets/css/null-2.4.css><link rel=stylesheet href=https://kakudokentaro.com/assets/css/common.css><link rel="shortcut icon" href=https://kakudokentaro.com/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=https://kakudokentaro.com/assets/css/document.css><link rel=stylesheet href=https://kakudokentaro.com/assets/css/single.css><title>【旧ブログ記事】nginxでrewriteを使わずにディレクトリ構造にするproxy_pass - Kakudo Kentaro</title><meta property="og:title" content="【旧ブログ記事】nginxでrewriteを使わずにディレクトリ構造にするproxy_pass - Kakudo Kentaro"><meta property="og:type" content="website"><meta property="og:image" content="https://kakudokentaro.com/assets/icon.png"><meta property="og:url" content="https://kakudokentaro.com/blog/2018/08/22/nginx-dir/"><meta property="og:site_name" content="Kakudo Kentaro"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@kakudo415"></head><body><header><div class=inner><h1><a href=https://kakudokentaro.com/>Kakudo Kentaro</a></h1><a href=https://kakudokentaro.com/blog/>Blog</a>
<a href=https://kakudokentaro.com/about/>About</a></div></header><main><div class=inner><h1>【旧ブログ記事】nginxでrewriteを使わずにディレクトリ構造にするproxy_pass</h1><time datetime=2018-08-22>2018-08-22 00:00</time><ul class=tags></ul><p class=warn><strong>この記事は以前のブログから引っ越してきたものです！</strong><br><a href=https://github.com/kakudo415/blog>以前のブログのGitHubリポジトリ</a></p><p>こんにちは、今回はこのブログのようにドメインの後ディレクトリを挟んでアプリケーションを動かすときにrewriteを使わない方法をご説明します</p><h2 id=locationで正規表現を使う>locationで正規表現を使う</h2><p>locationを指定するところで下のようにチルダ等を入れることで単に前方一致ではない正規表現を使うことができます</p><pre><code>location = 完全一致 {}  
location ^~ 正規表現(マッチしたら検索終了) {}  
location ~ 正規表現 {}  
location ~* 正規表現(大文字小文字区別しない) {}</code></pre><h2 id=マッチした文字列を変数にする>マッチした文字列を変数にする</h2><pre><code>location ~ (?&lt;変数名&gt;正規表現) {}</code></pre><p>このように変数名を指定して正規表現を使いかっこで括ることでlocation内で使える変数を作ることができます（変数名は既存のものと被らないように）<br>そしてこのように書くことで</p><pre><code>location ~ /dir/(?&lt;path&gt;.*) {
	proxy\_pass http://localhost:12345/$path$is\_arg$args;
}</code></pre><p><strong>$path</strong> には/dir/以下のURLが入り、<br><strong>$is_args</strong> にはクエリがある場合に ? が入り、<br><strong>$args</strong> にクエリが入るので、正しく/dir/を飛ばしてリバースプロキシできるわけですね</p><h2 id=最後にrewriteとの比較>最後に(rewriteとの比較)</h2><p>自分の環境ではrewrite時にPOSTするとうまくいかないところがあったので他のやり方を探したところこれが良さそうだと思いました</p><section class=share><div>Share on</div><a href="https://twitter.com/intent/tweet?text=%e3%80%90%e6%97%a7%e3%83%96%e3%83%ad%e3%82%b0%e8%a8%98%e4%ba%8b%e3%80%91nginx%e3%81%a7rewrite%e3%82%92%e4%bd%bf%e3%82%8f%e3%81%9a%e3%81%ab%e3%83%87%e3%82%a3%e3%83%ac%e3%82%af%e3%83%88%e3%83%aa%e6%a7%8b%e9%80%a0%e3%81%ab%e3%81%99%e3%82%8bproxy_pass - Kakudo%20Kentaro&url=https%3a%2f%2fkakudokentaro.com%2fblog%2f2018%2f08%2f22%2fnginx-dir%2f" rel="nofollow noopener noreferrer" target=_blank>Twitter</a></section></div></main></body></html>
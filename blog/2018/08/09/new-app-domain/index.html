<!doctype html><html prefix="og: https://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://kakudokentaro.com/assets/fonts/Inter-SemiBold.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://kakudokentaro.com/assets/fonts/Inter-Regular.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://kakudokentaro.com/assets/css/null-2.4.css><link rel=stylesheet href=https://kakudokentaro.com/assets/css/common.css><link rel="shortcut icon" href=https://kakudokentaro.com/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=https://kakudokentaro.com/assets/css/document.css><link rel=stylesheet href=https://kakudokentaro.com/assets/css/single.css><title>【旧ブログ記事】強制HTTPSのAPPドメインでLet's Encryptを活用しよう！ - Kakudo Kentaro</title><meta property="og:title" content="【旧ブログ記事】強制HTTPSのAPPドメインでLet's Encryptを活用しよう！ - Kakudo Kentaro"><meta property="og:type" content="website"><meta property="og:image" content="https://kakudokentaro.com/assets/icon.png"><meta property="og:url" content="https://kakudokentaro.com/blog/2018/08/09/new-app-domain/"></head><body><header><div class=inner><h1><a href=https://kakudokentaro.com/>Kakudo Kentaro</a></h1><a href=https://kakudokentaro.com/blog/>Blog</a>
<a href=https://kakudokentaro.com/about/>About</a></div></header><main><div class=inner><h1>【旧ブログ記事】強制HTTPSのAPPドメインでLet's Encryptを活用しよう！</h1><time datetime=2018-08-09>2018-08-09 00:00</time><p class=warn><strong>この記事は以前のブログから引っ越してきたものです！</strong><br><a href=https://github.com/kakudo415/blog>以前のブログのGitHubリポジトリ</a></p><p>こんにちは！今日は自分の新しいドメイン <a href=//kakudo.app>kakudo.app</a> についてです</p><h2 id=ほかのドメインと何が違うのか>ほかのドメインと何が違うのか？</h2><p>.appは今年(2018)の5月から運用が開始されたGoogle謹製の新作TLDです<br>Googleが当時過去最高の2500万ドル(約30億円)で競り落としたことで話題にもなりました<br>しかし、appドメインが他と違うのは落札額だけではありません<br>サイトをHTTPS化するのが <strong>強制</strong> です(HTTP Strict Transport Security)<br>.appドメインの使用が広がったり、同じようなHTTPS強制のドメインが増えれば、さらにWebの暗号化が進むと思われます</p><h2 id=lets-encryptとは>Let&rsquo;s Encryptとは？</h2><p>Let&rsquo;s Encryptとは、HTTPS接続をするために必要なSSL証明書を無料で発行してくれる機関です<br>簡単な手続きで今あるサイトをHTTPS化することができます<br>今回はこのLet&rsquo;s Encryptの力を借りて強制HTTPSに対応したいと思います</p><h2 id=自分の環境>自分の環境</h2><ul><li>Ubuntu 18.04 LTS</li><li>nginx (Let&rsquo;s Encryptの使用にはWebサーバーが必要です 他のWebサーバーも可)</li><li>letsencrypt (aptでインストールしておいてください)</li></ul><h2 id=やってみる>やってみる</h2><h3 id=lets-encryptのアクセスへの準備>Let&rsquo;s Encryptのアクセスへの準備</h3><p>まずは通常の通常のHTTPで認証用のアクセスを受け付ける準備をします(/etc/nginx/conf.d/hogehoge.conf内に追記)</p><pre><code>server {
	listen 80;
	listen [::]:80;  
	server\_name kakudo.app;  
	location / {
		return 301 https://$server\_name$request\_uri;
	}  
	location /.well-known/acme-challenge/ {
		root /var/www/letsencrypt;
	}
}</code></pre><p>この次に誤字脱字などが無いか、テストコマンドを実行します</p><pre><code>sudo nginx -t</code></pre><p>成功したら次のコマンドでnginxを再読み込みします(エラーが出たら間違いがないか確認してください)</p><pre><code>sudo nginx -s reload</code></pre><h3 id=コマンド実行で証明書を発行する>コマンド実行で証明書を発行する</h3><pre><code>sudo letsencrypt certonly --webroot -w /var/www/letsencrypt/ -d kakudo.app</code></pre><p>.appは無印HTTPを受け付けないと聞いていたので（Googleの中の人もそういってた、詳細は後述）<br>ここはエラーが出てその解決策をブログのネタにしようかと企んでいたのですが、あっさり通りました<br>なので、「.appドメイン取ってみたいけど証明書発行めんどくさいんちゃうん？」と思っている方。発行手順は他のドメインと同じ模様です<br>思っていた以上に無事発行できてしまったので、これをnginxに設定します</p><h3 id=できた証明書を設定しよう>できた証明書を設定しよう</h3><p>さっきの <strong>hogehoge.conf</strong> 内の <strong>server {}</strong> の外に以下を追記してください</p><pre><code>server {
	listen 443 ssl http2;
	listen [::]:443 ssl http2;  
	server\_name kakudo.app;  
	ssl\_certificate /etc/letsencrypt/live/kakudo.app/fullchain.pem;
	ssl\_certificate_key /etc/letsencrypt/live/kakudo.app/privkey.pem;  
	# お好みで location などの設定を追加してください
}</code></pre><p>この後テストコマンドと再読み込みをすれば設定は完了です<br>お疲れさまでした</p><h2 id=余談googleの中の人にappドメインについて聞いてみた>【余談】Googleの中の人にappドメインについて聞いてみた</h2><p>中の人ってすごいパイプがあるように聞こえる便利な言葉ですねｗ<br>要は問合せメールを送らせていただいただけなのですが、要約すると次のような質問と返答でした</p><p><em>自分「.appドメインはHTTPS必須って書いてあるけどSSHとかでは使えないんですか？」</em></p><p>これを聞いたのは、.appというドメインだったので単にWebアプリだけでない使い方もできるのではと思ったためです<br>そして、1日後帰ってきた答えがこちらです</p><p><em>中の人「HTTPS以外は使えないです、でもテクニカルサポートまでリクエストを送ったのでまだ確約できないです」</em></p><p>つまり、もうちょっと技術的な人にさらに又聞きしていただいているということみたいです<br>なので後日さらに回答いただけたら追記したいと思います</p><p>ただ現時点で分かっていることがあって、少なくとも <strong>SSHは使えます</strong><br>試してみたら普通に使えましたね</p><p><a href=https://ja.wikipedia.org/wiki/HTTP_Strict_Transport_Security>HSTS Wikipedia</a><br>ここを読むに、ブラウザがドメインを判別してHTTPで接続できないようにする仕組みのようです(間違えてたら <a href=https://twitter.com/kakudo415/>Twitter</a>とかに教えて頂けると嬉しいです)<br>なのでそもそもブラウザを介さないSSHなどは普通に使えるのではないかと思います</p><h2 id=ドメインを換装した感想>(ドメインを)換装した感想</h2><p>(逃したネタは大きいけど)めっちゃ設定は簡単でしたね！<br>appドメインは見た目が何となく好きなので今後はこっちメインに使うかもしれません<br>通信を暗号化するのはユーザーにとっても利益が大きいので、未対応の方は設定してみてはいかがでしょうか？</p><section class=share><div>Share on</div><a href="https://twitter.com/intent/tweet?text=%e3%80%90%e6%97%a7%e3%83%96%e3%83%ad%e3%82%b0%e8%a8%98%e4%ba%8b%e3%80%91%e5%bc%b7%e5%88%b6HTTPS%e3%81%aeAPP%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e3%81%a7Let%27s%20Encrypt%e3%82%92%e6%b4%bb%e7%94%a8%e3%81%97%e3%82%88%e3%81%86%ef%bc%81 - Kakudo%20Kentaro&url=https%3a%2f%2fkakudokentaro.com%2fblog%2f2018%2f08%2f09%2fnew-app-domain%2f" rel="nofollow noopener noreferrer" target=_blank>Twitter</a></section></div></main></body></html>
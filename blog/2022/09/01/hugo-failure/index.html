<!doctype html><html lang=ja prefix="og: https://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://kakudokentaro.com/assets/fonts/Inter-SemiBold.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://kakudokentaro.com/assets/fonts/Inter-Regular.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://kakudokentaro.com/assets/css/null-2.4.css><link rel=stylesheet href=https://kakudokentaro.com/assets/css/common.css><link rel="shortcut icon" href=https://kakudokentaro.com/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=https://kakudokentaro.com/assets/css/document.css><link rel=stylesheet href=https://kakudokentaro.com/assets/css/single.css><title>HugoとGitHub Pagesでハマったこと - Kakudo Kentaro</title><meta property="og:title" content="HugoとGitHub Pagesでハマったこと - Kakudo Kentaro"><meta property="og:type" content="website"><meta property="og:image" content="https://kakudokentaro.com/assets/icon.png"><meta property="og:url" content="https://kakudokentaro.com/blog/2022/09/01/hugo-failure/"><meta property="og:site_name" content="Kakudo Kentaro"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@kakudo415"></head><body><header><div class=inner><h1><a href=https://kakudokentaro.com/>Kakudo Kentaro</a></h1><a href=https://kakudokentaro.com/blog/>Blog</a>
<a href=https://kakudokentaro.com/about/>About</a></div></header><main><div class=inner><h1>HugoとGitHub Pagesでハマったこと</h1><time datetime=2022-09-01>2022-09-01 10:54</time><ul class=tags><li><a href=https://kakudokentaro.com/blog/tags/web/>Web</a></li><li><a href=https://kakudokentaro.com/blog/tags/hugo/>Hugo</a></li></ul><p>このページを作る過程でハマったこととその対処法について書きます。</p><h2 id=静的なファイルが配信されないパスがおかしい>静的なファイルが配信されない・パスがおかしい</h2><p>Hugoは<code>/static/</code>内のファイルを配信してくれますが、中身がそのままルート直下に置かれます。たとえば<code>/static/hoge.fuga</code>というファイルにアクセスしたいときは、<code>https://example.com/static/hoge.fuga</code>ではなく、<code>https://example.com/hoge.fuga</code>としなくてはなりません。これに気づかなかったため、前者のURLで404を吐き続けていました。</p><p>この仕様で問題となりそうなのが、<code>/static/</code>以下のファイル・ディレクトリ名とページ名が被ることです。そのため、<code>/static/assets/</code>のようにもう一段ディレクトリを深くして、<code>https://example.com/assets/hoge.fuga</code>のように静的ファイルをひとまとめに配信するようにしました。</p><p>設定ファイルでなんとかできると綺麗なのですが･･･</p><h2 id=trailing-slashurl末尾のスラッシュを無くせない>Trailing Slash（URL末尾のスラッシュ）を無くせない</h2><p><a href=https://github.com/gohugoio/hugo/issues/7458>ここ</a>を読む限り、サーバー側で対処する以外に解決策が無さそうです。</p><p>Trailing Slashは無いのが好みなのですが、天下のW3Cのブログ（下記）が有りのスタイルなのでこれに倣ったと思い納得することとします。</p><p><a href=https://www.w3.org/blog/2022/08/https-redirection-observations/>https://www.w3.org/blog/2022/08/https-redirection-observations/</a></p><h2 id=github-pagesに設定したはずのcustom-domainが消える>GitHub Pagesに設定したはずのCustom domainが消える</h2><p>当初は問題なくページを閲覧できるのに、しばらくすると404になり、設定したはずのCustom domainが消えているという症状です。</p><p><img src=../custom-domain-disappeared.png alt="Custom domain disappeared"></p><p>原因は、Custom domain設定時に自動的に追加された<code>CNAME</code>ファイルを、GitHub Actionsが消し飛ばしてしまったからでした。
新しい公開ファイルで<code>gh-pages</code>ブランチを更新するときに、<code>CNAME</code>ファイルごと置き換えてしまっているわけです。</p><h3 id=対処法>対処法</h3><p><code>/static/</code>下に、直接<code>CNAME</code>ファイルの内容を書いておけば良いです。
<code>/static/</code>ディレクトリの内容は、生成時に公開ディレクトリ直下にそのままコピーされます。</p><p>というか、<a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/#use-a-custom-domain>Host on GitHub | Hugo</a>にめちゃくちゃ丁寧に書いてありました。ちゃんと読まないのが悪い･･･。n敗目。</p><section class=share><div>Share on</div><a href="https://twitter.com/intent/tweet?text=Hugo%e3%81%a8GitHub%20Pages%e3%81%a7%e3%83%8f%e3%83%9e%e3%81%a3%e3%81%9f%e3%81%93%e3%81%a8 - Kakudo%20Kentaro&url=https%3a%2f%2fkakudokentaro.com%2fblog%2f2022%2f09%2f01%2fhugo-failure%2f" rel="nofollow noopener noreferrer" target=_blank>Twitter</a></section></div></main></body></html>
<!doctype html><html prefix="og: https://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://kakudokentaro.com/assets/fonts/Inter-SemiBold.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://kakudokentaro.com/assets/fonts/Inter-Regular.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://kakudokentaro.com/assets/css/null-2.4.css><link rel=stylesheet href=https://kakudokentaro.com/assets/css/common.css><link rel="shortcut icon" href=https://kakudokentaro.com/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=https://kakudokentaro.com/assets/css/document.css><link rel=stylesheet href=https://kakudokentaro.com/assets/css/single.css><title>禁忌かもしれない未読マークと、消えないCSS疑似要素 - Kakudo Kentaro</title><meta property="og:title" content="禁忌かもしれない未読マークと、消えないCSS疑似要素 - Kakudo Kentaro"><meta property="og:type" content="website"><meta property="og:image" content="https://kakudokentaro.com/assets/icon.png"><meta property="og:url" content="https://kakudokentaro.com/blog/2022/09/03/unread-marker/"></head><body><header><div class=inner><h1><a href=https://kakudokentaro.com/>Kakudo Kentaro</a></h1><a href=https://kakudokentaro.com/blog/>Blog</a>
<a href=https://kakudokentaro.com/about/>About</a></div></header><main><div class=inner><h1>禁忌かもしれない未読マークと、消えないCSS疑似要素</h1><time datetime=2022-09-03>2022-09-03 06:38</time><h2 id=未読マークの魔力>未読マークの魔力</h2><p>未読マークってどうしてあんなに消したくなるんでしょうか。特に用のないアプリ、今読まなくてもよいメールでも、未読マークのためについつい一度開いたりしてしまいます。</p><p>整然と並んだ「既読たち」の中に、目立つはみ出し者の「未読」がいると気持ち悪くなる人間の習性でもあるのかもしれません。</p><p>さて、おもしろそうだったのでそんな未読マークを実装してみました。まだお読みでない記事があったら<a href=/blog/>ブログ記事一覧</a>を見てみてください。このように青い点が未読記事の右に表示されているはずです。</p><p><img src=../unread-marker.png alt=未読マーク></p><p>実装といっても、既読かどうかはブラウザが判断してくれるので簡単です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>a</span>.<span style=color:#a6e22e>unread-marker</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>flex</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>align-items</span>: <span style=color:#66d9ef>center</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>a</span>.<span style=color:#a6e22e>unread-marker</span>::<span style=color:#a6e22e>after</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>content</span>: <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>block</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>height</span>: <span style=color:#ae81ff>0.5</span><span style=color:#66d9ef>rem</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>width</span>: <span style=color:#ae81ff>0.5</span><span style=color:#66d9ef>rem</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>margin-left</span>: <span style=color:#66d9ef>auto</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>flex-shrink</span>: <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>border-radius</span>: <span style=color:#ae81ff>50</span><span style=color:#66d9ef>%</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background</span>: <span style=color:#ae81ff>#0077C8</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>a</span>.<span style=color:#a6e22e>unread-marker</span>:<span style=color:#a6e22e>visited</span>::<span style=color:#a6e22e>after</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>none</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>未読マークを付けたいリンクに対して、CSSの疑似要素でマークを作ればよいです。</p><h2 id=なぜか消えない-after>なぜか消えない ::after</h2><h3 id=起こったこと>起こったこと</h3><p>未読マークの役割から言って、読んだ記事の横にあるマークは当然消すべきです。そこで以下のように書いているわけですが、なぜか疑似要素<code>::after</code>が消えません･･･。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>a</span>.<span style=color:#a6e22e>unread-marker</span>:<span style=color:#a6e22e>visited</span>::<span style=color:#a6e22e>after</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>none</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>消す系の指定をてんこ盛りにしてもダメでした。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>a</span>.<span style=color:#a6e22e>unread-marker</span>:<span style=color:#a6e22e>visited</span>::<span style=color:#a6e22e>after</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>content</span>: <span style=color:#66d9ef>none</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>none</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>visibility</span>: <span style=color:#66d9ef>hidden</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ブラウザの開発者ツールを確認すると正常に<code>display</code>を上書きできているように見えます。</p><p><img src=../checking-with-dev-tool.png alt="Checking with dev tool"></p><p>しかし、計算済みタブを見ると、<code>display: none</code>が認識されていながら<code>display: block</code>が使われています。不思議です。</p><p><img src=../calculated.png alt=計算済みタブでおかしな挙動になる様子></p><h3 id=理由>理由</h3><p>プライバシー上の理由から、<code>:visited</code>疑似クラスでは<code>display</code>等が使えないことが原因でした。</p><p><a href=https://developer.mozilla.org/ja/docs/Web/CSS/Privacy_and_the_:visited_selector>プライバシーと :visited セレクター - CSS: カスケーディングスタイルシート | MDN</a>には、次のように書かれています。（参照: 2022-09-03）</p><blockquote><p>およそ 2010 年よりも前、 CSS の <code>:visited</code> セレクターによって、ウェブサイトがユーザーの閲覧履歴を明らかにし、ユーザーがどのサイトを訪問したかを把握することができました。これは <code>window.getComputedStyle</code> およびその他の技術を用いて行われていました。この処理はすばやく実行され、ユーザーがどこを訪れたかを特定できるだけでなく、ユーザーの身元に関する多くの情報を推測することも可能になりました。</p><p>この問題を緩和するために、ブラウザーは訪問済みリンクから受け取ることができる情報量を制限されるようになりました。</p></blockquote><p><a href=https://developer.mozilla.org/ja/docs/Web/CSS/:visited>:visited - CSS: カスケーディングスタイルシート | MDN</a>によると、具体的には次のプロパティが使えます。（参照: 2022-09-03）</p><blockquote><p>利用できる CSS プロパティは、 <code>color</code>, <code>background-color</code>, <code>border-color</code>, <code>border-bottom-color</code>, <code>border-left-color</code>, <code>border-right-color</code>, <code>border-top-color</code>, <code>column-rule-color</code>, <code>outline-color</code>, <code>text-decoration-color</code>, <code>text-emphasis-color</code> です。</p></blockquote><h3 id=対症療法>対症療法</h3><p>とりあえず、<code>background: #FFF</code>とすることで見えなくしました。ダークモード対応は遠そうです。</p><h2 id=未読マークは黒魔術かもしれない>未読マークは黒魔術かもしれない</h2><p>この記事を書いていて、未読マークは読む人の負荷をいたずらに上げる良くないデザインな気がしてきました。
僕の気が変わったら、デザインを変更したり、廃止したりすると思います。</p><section class=share><div>Share on</div><a href="https://twitter.com/intent/tweet?text=%e7%a6%81%e5%bf%8c%e3%81%8b%e3%82%82%e3%81%97%e3%82%8c%e3%81%aa%e3%81%84%e6%9c%aa%e8%aa%ad%e3%83%9e%e3%83%bc%e3%82%af%e3%81%a8%e3%80%81%e6%b6%88%e3%81%88%e3%81%aa%e3%81%84CSS%e7%96%91%e4%bc%bc%e8%a6%81%e7%b4%a0 - Kakudo%20Kentaro&url=https%3a%2f%2fkakudokentaro.com%2fblog%2f2022%2f09%2f03%2funread-marker%2f" rel="nofollow noopener noreferrer" target=_blank>Twitter</a></section></div></main></body></html>